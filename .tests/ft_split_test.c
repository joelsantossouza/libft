/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_split_test.c                                    :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: joesanto <joesanto@student.42porto.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/09/29 07:54:21 by joesanto          #+#    #+#             */
/*   Updated: 2025/10/03 13:10:03 by joesanto         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "libft.h"
#include <atf-c.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>

#define NELEM(tab) (sizeof(tab) / sizeof(char *))
#define TEST_NULLS	1<<0
#define RED			"\e[0;31m"
#define GREEN		"\e[0;32m"
#define RESET		"\e[0m"

char	*tests_titles[] = {
	"Null Strings",
	"Empty Strings",
	"Big Strings",
};
static int	i;

typedef struct s_range
{
	int	min;
	int	max;
}	t_range;
t_range _range = {-128, 127};

int	split_cmp(char **split1, char **split2)
{
	if (!split1 && !split2)
		return (0);
	if (!split1)
		return (-1);
	if (!split2)
		return (1);
	while (!ft_strcmp(*split1, *split2) && *split1)
	{
		split1++;
		split2++;
	}
	return (ft_strcmp(*split1, *split2));
}

void	print_split(char **split, char *sep)
{
	if (!split)
		printf("(null_array)");
	else
	{
		printf("%s", *split);
		while (*++split)
			printf("%s%s", sep, *split);
	}
	printf("\n");

}

static int	fill(char **vector, char const *str, char delimeter)
{
	size_t	len;
	size_t	i;

	i = 0;
	while (*str)
	{
		len = 0;
		while (*str == delimeter && *str)
			++str;
		while (*str != delimeter && *str)
		{
			++len;
			++str;
		}
		if (len)
		{
			vector[i] = ft_substr(str - len, 0, len);
			if (!vector[i])
			{
				ft_freearray((void **) vector, free);
				return (1);
			}
			++i;
		}
	}
	return (0);
}

char	**split(char const *s, char c)
{
	char	**ptr;
	size_t	len;

	if (NULL == s)
		return (NULL);
	len = ft_word_count(s, c);
	ptr = malloc(sizeof(char *) * (len + 1));
	if (!ptr)
		return (NULL);
	if (fill(ptr, s, c))
		return (NULL);
	ptr[len] = NULL;
	return (ptr);
}

void	test(char	*tab[], size_t size, t_range range, int flags)
{
	char	**expected;
	char	**output;
	char	*color;
	int		find;

	printf("\n<test%02d> %s\n", i, tests_titles[i]);
	while (size--)
	{
		find = range.min - 1;
		while (++find <= range.max)
		{
			expected = flags & TEST_NULLS ? 0 : split(tab[size], find);
			output = ft_split(tab[size], find);
			color = !split_cmp(expected, output) ? GREEN : RED;

			printf("%s", color);
			printf("Input:   \t%s\t%d\n", tab[size], find);
			printf("Expected:\t"); print_split(expected, ", ");
			printf("Output:  \t"); print_split(output, ", ");
			printf("%s", RESET);

			ATF_CHECK(!split_cmp(expected, output));
			printf("----------\n");
		}
	}
}

// TEST 00 --> NULL STRINGS
ATF_TC(test00);
ATF_TC_HEAD(test00, tc)
{
	atf_tc_set_md_var(tc, "descr", tests_titles[0]);
}
ATF_TC_BODY(test00, tc)
{
	char	*tab[] = {
		0,
	};

	i = 0;
	test(tab, NELEM(tab), _range, TEST_NULLS);
}

// TEST 01 --> EMPTY STRINGS
ATF_TC(test01);
ATF_TC_HEAD(test01, tc)
{
	atf_tc_set_md_var(tc, "descr", tests_titles[1]);
}
ATF_TC_BODY(test01, tc)
{
	char	*tab[] = {
		"",
	};

	i = 1;
	test(tab, NELEM(tab), _range, 0);
}

// TEST 02 --> BIG STRINGS
ATF_TC(test02);
ATF_TC_HEAD(test02, tc)
{
	atf_tc_set_md_var(tc, "descr", tests_titles[2]);
}
ATF_TC_BODY(test02, tc)
{
	char	*tab[] = {
		"   santos joel souza",
		"  - santos joel souza",
		" 1234567890qwertyuiop[asdfghjkl;'\\asdfghjkl;;'zxcvbnm,./",
		" 10234hh03389rtnc1013908tycn0yc8unc0g9813umtgc-o18ugj,1cg19u,-148g18yu,1-98gyc,-18guc,1-8fgh1c-8gcghm-1 8gj1m-g8ucm1-8gmc1-8gcm1-g8j1cm-g8um1c-g81234567890qwertyuiop[asdfghjkl;'\\asdfghjkl;;'zxcvbnm,./",
		"f 1-3oigfj 13-ifj 3poifj p13oifj po i",
		"ffffffffffffffffffffffffffff",
		"  ffffffffffffffffffffffffffff    ",
		"  ffffffffffffffffffffffffffff    \\\n\n\n",
		"  ffffff\n\n \n\n \nffffffffffffffffff    \\\n\n\n",
		" \n",
		"\x9a\x01\xaf\x22\x13\xff\x02",
		"\x10\x33\x44\x55\x66\x77\x88\x99\xaa\xbb",
		"\x01",
		"\xab\xcd\xef\x12\x34\x56\x78\x90",
		"\xff\xfe\xfd\xfc\xfb\xfa\xf9\xf8\xf7\xf6",
		"\x00\x11\x22\x33\x44\x55\x66\x77\x88\x99\xaa\xbb\xcc",
		"\x42\x42\x42",
		"\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b",
		"",
		"\x10\x20\x30\x40\x50\x60\x70",
		"\xaa\xbb\xcc\xdd\xee\xff",
		"\x01\x23\x45\x67\x89\xab\xcd\xef",
		"\xff",
		"\x99\x98\x97\x96\x95\x94",
		"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09",
		"\xfe\xdc\xba\x98\x76\x54\x32\x10",
		"\x0f\x1e\x2d\x3c\x4b\x5a\x69\x78\x87",
		"\x01\x01\x01\x01\x01\x01\x01\x01",
		"\xaa",
		"\x7e\x7d\x7c\x7b\x7a\x79\x78\x77\x76",
		"\x55\xaa\x55\xaa\x55\xaa",
		"\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19",
		"\xff\xee\xdd\xcc\xbb\xaa",
		"\x21\x43\x65\x87\xa9\xcb\xed",
		"\x99\x00\x99\x00\x99\x00\x99",
		"\x01\x02\x03",
		"\xab\xac\xad\xae\xaf",
		"\x12\x34\x56\x78\x9a\xbc\xde\xf0",
		"\xcd\xdc\xcd\xdc\xcd",
		"\x90\x80\x70\x60\x50\x40\x30\x20\x10",
		"\x77\x66\x55\x44\x33\x22\x11",
		"\xfa\xfb\xfc\xfd\xfe\xff",
		"\x01\x23\x45\x67",
		"\x7f\x7e\x7d\x7c\x7b",
		"\x10\x20\x30\x40\x50",
		"\xff\x00\xff\x00",
		"\x12\x12\x12\x12\x12\x12",
		"\x45\x46\x47\x48\x49\x4a\x4b",
		"\x98\x97\x96\x95\x94\x93",
		"\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3",
		"\x33\x66\x99\xcc\xff",
		"\x01\x10\x20\x30\x40\x50\x60\x70\x80\x90",
		"\x00",
		"\xff\xff\xff\xff",
		"\xab\xcd",
		"\x12\x34\x56\x78\x90",
		"\x89\x88\x87\x86\x85\x84\x83\x82\x81\x80",
		"\x55\x44\x33\x22\x11",
		"\x00\xff",
		"\x0a\x0b\x0c\x0d\x0e\x0f",
		"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a",
		"\xf1\xf2\xf3\xf4\xf5",
		"\xaa\xaa\xaa\xaa\xaa\xaa",
		"\x7f",
		"\x12\x13\x14\x15\x16",
		"\x9a\xbc\xde\xf0\x12\x34",
		"\x55\x66\x77\x88\x99\xaa",
		"\x01\x11\x21\x31\x41\x51\x61",
		"\xfe\xed\xdc\xcb\xba\xa9",
		"\x10\x10\x10\x10",
		"\x77\x88\x99",
		"\xaa\xbb\xcc",
		"\x0f\x1f\x2f\x3f\x4f\x5f\x6f",
		"\x01\x23\x45\x67\x89",
		"\x44\x55\x66\x77\x88\x99\xaa\xbb",
		"\xff\xfe\xfd\xfc",
		"\x00\x01\x02\x03",
		"\x12\x22\x32\x42\x52",
		"\x9f\x9e\x9d\x9c\x9b",
		"\x33\x34\x35\x36\x37\x38\x39",
		"\x01\x02",
		"\xab\xbb\xcb\xdb\xeb\xfb",
		"\x77\x76\x75\x74\x73\x72\x71\x70",
		"\x10\x20",
		"\x42\x41\x40\x3f\x3e",
		"\x55\x65\x75\x85\x95\xa5",
		"\x01\x23",
		"\x7f\x7f\x7f\x7f\x7f",
		"\xaa\x99\x88\x77\x66",
		"\x12\x13\x14",
		"\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99",
		"\x01\x02\x03\x04\x05",
		"\xfe\xdc\xba",
		"\x66\x77\x88\x99",
		"\x0a\x0b\x0c\x0d",
		"\x21\x22\x23\x24\x25",
		"\x11\x22\x33\x44\x55\x66",
		"\xff\x01\x02\x03",
		"\xab\xac\xad",
		"\x42\x43\x44\x45\x46\x47",
		"\x01\x10\x20\x30",
		"\x99\x88\x77\x66\x55\x44",
		"\x0f\x0e\x0d\x0c\x0b",
		"\x10\x11\x12\x13",
		"\xfe\xff",
		"\x01\x01\x01",
		"\x33\x22\x11",
		"\x55\x44\x33\x22",
		"\xaa\xbb",
		"\x77\x77\x77\x77",
		"\x12\x34",
		"\x99",
		"\x01",
		"\xff",
		"\x01\x23\x45\x67\x89\xab\xcd\xef\x10\x20\x30\x40\x50\x60\x70\x80\x90\xa0\xb0\xc0\xd0\xe0\xf0\x11\x22\x33\x44\x55\x66\x77\x88\x99\xaa\xbb\xcc\xdd\xee\xff\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40",
		"\xff\xfe\xfd\xfc\xfb\xfa\xf9\xf8\xf7\xf6\xf5\xf4\xf3\xf2\xf1\xf0\xef\xee\xed\xec\xeb\xea\xe9\xe8\xe7\xe6\xe5\xe4\xe3\xe2\xe1\xe0\xdf\xde\xdd\xdc\xdb\xda\xd9\xd8\xd7\xd6\xd5\xd4\xd3\xd2\xd1\xd0\xcf\xce\xcd\xcc\xcb\xca\xc9\xc8\xc7\xc6\xc5\xc4\xc3\xc2\xc1\xc0\xbf\xbe\xbd\xbc\xbb\xba\xb9\xb8\xb7\xb6\xb5\xb4\xb3\xb2\xb1\xb0\xaf\xae\xad\xac\xab\xaa\xa9\xa8",
		"\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68",
		"\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff\xaa\xbb\xcc\xdd\xee\xff",
		"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58",
		"\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7",
		"\x77\x66\x55\x44\x33\x22\x11\x00\xff\xee\xdd\xcc\xbb\xaa\x99\x88\x77\x66\x55\x44\x33\x22\x11\x00\xff\xee\xdd\xcc\xbb\xaa\x99\x88\x77\x66\x55\x44\x33\x22\x11\x00\xff\xee\xdd\xcc\xbb\xaa\x99\x88\x77\x66\x55\x44\x33\x22\x11\x00\xff\xee\xdd\xcc\xbb\xaa\x99\x88\x77\x66\x55\x44\x33\x22\x11\x00\xff\xee\xdd\xcc\xbb\xaa\x99\x88\x77\x66\x55\x44\x33\x22",
		"\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0\x12\x34\x56\x78\x9a\xbc\xde\xf0",
	};

		i = 2;
		test(tab, NELEM(tab), _range, 0);
	}

	// TEST PROGRAM
	ATF_TP_ADD_TCS(tp)
	{
		ATF_TP_ADD_TC(tp, test00);
		ATF_TP_ADD_TC(tp, test01);
		ATF_TP_ADD_TC(tp, test02);

		return (atf_no_error());
	}

